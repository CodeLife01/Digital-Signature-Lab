# Hashing vs Encryption

## Background:

Hashing and encryption are both cryptographic techniques used to secure data, but they serve different purposes and function in distinct ways:

### 1. **Purpose**:

- **Hashing**: The primary purpose of hashing is to verify data integrity. It transforms data into a fixed-size string (hash) that uniquely represents the original data. Hashing is typically used to ensure that data (such as files, passwords, or messages) has not been altered. It is a one-way process, meaning that once data is hashed, it cannot be reverted back to its original form.
- **Encryption**: Encryption's main goal is to secure the confidentiality of data. It converts readable data (plaintext) into an unreadable format (ciphertext) using an encryption algorithm and a key. Unlike hashing, encryption is a two-way process. The encrypted data can be decrypted back into its original form, provided you have the correct decryption key.

### 2. **Reversibility**:

- **Hashing**: Hashing is **irreversible**. There is no way to reconstruct the original data from the hash. This is why it is ideal for password storage, where the original password isn't needed, only verification that it matches the hash.
- **Encryption**: Encryption is **reversible**. Encrypted data can be decrypted back into its original form using the correct decryption key. This is necessary when you need to securely store data but also retrieve it in its original form (e.g., for secure communication).

### 3. **Key Usage**:

- **Hashing**: Hashing does not use a key. The same input will always produce the same hash output. However, for additional security, you can add a "salt" to the input before hashing, especially for password storage, to make it harder to crack.
- **Encryption**: Encryption uses a key (or keys, in the case of asymmetric encryption). The same data encrypted with different keys will produce different ciphertexts. The key is crucial for decrypting the data.

### 4. **Common Applications**:

- **Hashing**: Commonly used for checksums, digital signatures, and password storage. Hashing ensures that files or data have not been tampered with by comparing the original hash with the hash of the received data.
- **Encryption**: Used for securing communications, such as email encryption, file encryption, and data transmission over the internet (e.g., HTTPS). Encryption ensures that only authorized parties can access the original information.

### Summary:

- **Hashing** is a one-way process for ensuring data integrity, where the original data cannot be recovered from the hash.
- **Encryption** is a two-way process for securing data confidentiality, allowing the original data to be restored using a decryption key.

## Task 1 - Encryption

The Encrypting File System (EFS) is a feature in the Windows operating system that enables users to encrypt individual files and folders for added security. EFS can be accessed through File Explorer or via the command line using the **cipher** command. It integrates smoothly with the Windows NTFS file system, providing secure storage and easy access to encrypted files.

In this exercise, you will perform file and folder-level encryption using both Windows Explorer and the Windows Command Prompt.

### Objectives:

After completing this exercise, you should be able to:

- Encrypt a file.
- Encrypt a folder.

### Lab Setup:

Using our VirtualBox lab set up we will be using the Domain Controller and one Windows machine. Ensure you take a snapshot or have a recent snapshot you can revert back to after the exercise.  

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/5cb56489-3e55-4a9d-bf2d-230a6b3f4ff6/image.png)

### Task 1 - Encrypt a File

Cipher.exe is a command-line utility used to encrypt and decrypt files and folders on an NTFS file system. Once encryption is applied, the encryption keys are tied to the user account that performed the action. As a result, files encrypted by one user cannot be accessed by another, and any encrypted file will be automatically decrypted when opened by the user who encrypted it.

The **cipher.exe** command in Windows is primarily used to manage **Encrypting File System (EFS)** encryption. EFS is a feature in NTFS (New Technology File System) that allows for file and folder encryption at the filesystem level.

### Encryption Algorithm Used by Cipher.exe

By default, **cipher.exe** utilizes the **Advanced Encryption Standard (AES)** algorithm for encrypting files when using EFS. Specifically, it often employs **AES-256**, which refers to AES with a 256-bit key size, providing a high level of security.

### How Cipher.exe and EFS Work:

1. **File Encryption**:
    - When a user marks a file or folder as encrypted using **cipher.exe** or through the file properties (EFS), the file's data is encrypted using a symmetric key algorithm (AES-256).
    - Each file gets a unique **File Encryption Key (FEK)** generated during encryption.
2. **Key Protection**:
    - The FEK itself is encrypted using the user's **public key** (part of the asymmetric key pair generated by EFS).
    - The encrypted FEK is then stored in the file header. This ensures that only the user's private key can decrypt the FEK and thus decrypt the file.
3. **Accessing Encrypted Files**:
    - When an authorized user accesses the encrypted file, the system automatically retrieves the encrypted FEK from the file header.
    - The user's private key is used to decrypt the FEK.
    - Once the FEK is decrypted, it can be used to decrypt the file’s contents using AES-256.
4. **User Key Management**:
    - The user’s EFS keys (public/private key pair) are typically managed by the Windows operating system and can be linked to certificates issued by a public key infrastructure (PKI).

**Summary:**

- **cipher.exe** uses **AES-256** for encryption.
- The process involves generating a **File Encryption Key (FEK)** that is then encrypted using the user's public key.
- Decryption requires the user's private key, which unlocks the FEK, allowing the AES-256 decryption to happen.

This setup ensures that only authorized users can access the encrypted files, and it provides strong security through AES-256 encryption.

In this task, you will use cipher.exe to encrypt a file.

1. On the Windows machine, open the command promt and navigate to the Documents folder.
2. In the Command Prompt window, **type** the following and **press** Enter:

```go
echo “This is a secret file” > secretfile.txt
```

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/95947ccc-7864-4789-8a08-c101dc78789e/image.png)

1. In the Command Prompt window, **type** the following and **press** Enter:

```go
cipher /e secretfile.txt
```

1. **Observe** the secretfile.txt was encrypted. The /e in the command is used to encrypt specific files or directories. The /d switch would be used to decrypt a file.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/1b6da90e-eb06-4108-ab6f-76a9e6c34a77/image.png)

1. Open file explorer and navigate to the Documents folder. See the yellow padlock on the upper right corner of the document demonstrating that the file is encrypted. Only the user that encrypted it will be able to open and read it. 

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/6f861938-fc62-4ac4-bd79-e5ed270daf00/image.png)

### Task 2 - Encrypt a Folder

As encryption is done at the file level, encryption can occur at the folder level using EFS.

In this task, you will use File Explorer to encrypt a folder.

1. Create a new folder called Secret_Folder in the Documents folder.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/5d26491d-a750-4b52-8467-1e3b369d6ef5/image.png)

1. In the command line navigate to the Secret_File folder and run the command below, which creates a new file.

```go
echo “This is a another secret file” > anothersecretfile.txt
```

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/a89e67ab-0bd3-4244-a625-34d23a2f96df/image.png)

1. **Right-click** on Secret_Folder and **select** Properties.
2. In the Secret_Folder Properties window, **select** Advanced.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/920a5bba-916b-44ac-a6bb-98e6688acb8e/image.png)

1. In the Advanced Attributes window, **tick** the checkbox next to Encrypt contents to secure data.

**Click** OK.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/4a32d844-0065-4b12-a5f8-8e4aba2947d7/image.png)

1. In the Secrets_Folder Properties window, **click** OK.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/95bbfc49-0bec-406c-a0e8-f84102bd0b0b/image.png)

1. Select OK when prompted to apply changes.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/ffaa4b5d-a318-4cbb-85ec-142fed5e07bb/image.png)

As seen below, Secret_Folder now has the padlock icon.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/ed3efebf-e492-48d1-b0e8-6076b4db6702/image.png)

1. Open Secret_Folder. As seen below the file inside the folder is also encrypted.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/99b7bb36-266a-424e-b836-ad64687b5cbe/image.png)

We can test the encryption by switching users from pprice to the domain Administrator. Once Administrator is logged in navigate to pprice’s Document’s folder and try to open secretfile.txt.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/7b09f1e6-4453-4bde-88e9-7e0f777e9344/image.png)

As seen above, even a domain Administrator can not open the file.

## Exercise 2 - Hashing

Hashing is a cryptographic technique that generates a unique, fixed-size string of characters from data of any size. It is commonly used to verify the integrity of files, folders, and data volumes, as any change to the original data will result in a different hash output, signaling that a modification has occurred. Hashing is a one-way process, meaning it is mathematically impossible to reverse the hash and retrieve the original input.

In this exercise, you will manually perform hashing in both Windows and Linux environments.

### Objectives

After completing this exercise, you should be able to:

- Conduct hashing in Windows.
- Conduct hashing in Linux.

### Lab Setup

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/26a33d99-289f-4467-b35a-5cbe583b9eaf/image.png)

### Task 1 - Conduct Hashing in Windows

In Windows, hash values can be computed in the command line using the certutil command for common hashes such as MD2, MD4, MD5, SHA-1, SHA-256, and SHA-512.

In this task, you will manually compute hashes in the Windows Command Prompt.

1. On the Windows machine, o pen the command promt and navigate to the Documents folder.
2. In the Command Prompt window, **type** the following and **press** Enter:

```go
certutil -hashfile  secretfile.txt MD5
```

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/01121da6-7b74-4492-bdcf-809363c73231/image.png)

1. In the Command Prompt window, **type** the following and **press** Enter:

```go
certutil -hashfile secretfile.txt SHA1
```

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/b8fe47e8-514c-4318-9c6b-3745b9557461/image.png)

1. In the Command Prompt window, **type** the following and **press** Enter:

```go
certutil -hashfile secretfile.txt SHA256
```

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/53b41fa0-b10a-4432-858f-b7687b4fd897/image.png)

### Task 2 - Conduct Hashing in Linux

In Linux, hash values can also be conducted in the command line for common hashes such as MD5, SHA-1, SHA-256, and SHA-512.

In this task, you will manually compute hashes in the Linux command line.

1. Open the Terminal window in Kali Linux and navigate to the Documents folder. Then type the following to commands to create three files in the Documents folder.  

```go
echo “This is the first secret” > secret1.txt
```

```go
echo "this is the second secret" > Secret2.txt
```

```go
echo "this is the third secret" > Secret3.txt
```

1. Run the follow command to ensure the files were created.

```go
ls -la
```

**Note:** The “ls” command lists files and directories. la designates that the display should use the detailed long format and include all files (including hidden files and directories).

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/0bb98a38-80fe-44ff-8f71-91ae44435462/image.png)

As seen above there are three files in this folder: secrets1.txt, secrets2.txt, and secrets3.txt.

1. In the Terminal window, **type** the following and **press** Enter:

```go
md5sum secret1.txt
```

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/1a506784-b9ae-485b-9b5a-70825747038b/image.png)

1. We can speed up the process by running the command below.

```go
md5sum *.txt > hashes.txt
```

**Note:** The “*” indicates that all files in the current directory should be hashed. The “>” directs the output of the md5sum command to a file called hashes.txt.

1. Using cat we can read the hashes.txt file.

```go
cat hashes.txt
```

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/7390e3ca-2a5c-42a3-ac3d-b909fee0632d/image.png)

**Note:** Observe md5 hashes for the three files in the current directory.

1. In the Terminal window, **type** the following and **press** Enter:

```go
echo CHANGE >> secret1.txt
```

**Note:** The “>>” characters are used to append a string to the end of the file, rather than “>” which would replace the contents of the file.

1. In the Terminal window, **type** the following and **press** Enter:

```go
tail -n 1 secret1.txt
```

**Note:** By default, the tail command displays the last 10 lines of a file. The -n switch designates the number of last lines to be displayed, in this case, 1, so only the last line is displayed.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/63ef89df-1730-44b0-82a8-88446c0dbfb0/image.png)

Observe the string “CHANGE” has been appended to the last line of the file. This change will change the hash output of the mytext.txt file.

1. In the Terminal window, **type** the following and **press** Enter:

```go
md5sum secret1.txt
```

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/a34b775e-9e54-4baf-b129-8db96ff11c56/image.png)

**Note:** Observe the MD5 hash values of the unmodified secret1.txt file and modified secret1.txt file are different. This indicates a change in the file has occurred.

1. In the Terminal window, **type** the following and **press** Enter:

```go
md5sum -c hashes.txt
```

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/15bc5144-a76f-4c10-8849-c99b08c9eb32/546e2dce-5acb-4349-b218-1ef896871899/image.png)

**Note:** The -c switch instructs the command to check the checksums of the files against a provided list (the hashes.txt file).

The output indicates, as expected, that the secret1.txt file hashcheck has failed. This is because of the change made to the file.